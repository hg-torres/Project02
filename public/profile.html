<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>







  
<h1>Profile</h1>
<p class="lead">Here are <span id="username">johndoe</span>'s anime!</p>
<a href="index.html">Home</a>

</div>
<div id="posts" class="row"></div>
</div>




<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


<script>

  async function logoutUser() {
    localStorage.removeItem('username')
    localStorage.removeItem('token')
    location = '/login.html'
  }

     document.addEventListener('click', event => {

        if (event.target.className === 'delete') {
          const index = parseInt(event.target.dataset.index)
          console.log(index)
          axios.delete(`./api/animes/${index}`, {
            headers: {
              'Authorization': `Bearer ${localStorage.getItem('token')}`
            }
          })
            .then(() => {
             
              console.log(event.target.parentNode)
              event.target.parentNode.innerHTML = ''
  
              console.log('Anime Deleted')
            })
            .catch(err => console.log(err))
        }
      })


  async function getProfile() {
    try {
      const { data: user } = await axios.get('/api/users/profile', {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        }
      })
      return user

    } catch (err) {
      location = '/login.html'
    }
  }

  async function renderPost({id, title, image, rating, synopsis }) {
    const animeElem = document.createElement('div')
    animeElem.innerHTML = ''
    animeElem.innerHTML = `
    <div class="row bg-light p-5 rounded-md mb-2 mt-2">
      <h2>${title}</h2><img src='${image}' alt='${title}' style="width:75%;">
      <h4>Rating: ${rating}</h4>
      <p>Synopsis: ${synopsis}</p>
      <button class ="delete" data-index =${id}> Delete </button>
      </div>
      `
      document.getElementById('posts').prepend(animeElem)
  }

  async function renderPosts() {
    
    const { animes } = await getProfile()
    animes.forEach(anime => renderPost(anime))
   
  }

  async function renderUsername() {
    const username = localStorage.getItem('username')

    document.getElementById('username').textContent = username
  }

  // document.getElementById('logout').addEventListener('click', logoutUser)











  renderPosts()
  renderUsername()

  

</script>



</body>


</html>