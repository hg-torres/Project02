<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- METRO 4  -->
  <link rel="stylesheet" href="https://cdn.metroui.org.ua/v4.3.2/css/metro-all.min.css">
  <link href="metro-icons.css" rel="stylesheet">

  <!-- <link rel="stylesheet" href="index.css"> -->

  <title>Anime</title>

  <style>
    body {
      /* background-image: url('https://user-images.githubusercontent.com/92974218/148212131-5c2488b4-bc88-492e-8cec-c452cd05973d.jpg');  */
      background-color: black;
      color: white;
      font-family: consolas;
      background-repeat: no-repeat;
      background-position:
        bottom left;
    }

.word {
  /* background: transparent; */
  color: black;
  position: relative;
  right: -70px;
  top: 135px;
  width: 100px;
  height: 100px;
  /* border: 1px solid green; */
}

header {
  width: 100%;
  opacity: 0.5;
  position: relative;
  top: 100px;
  background-color: black;
  color: white;
  text-align: center;
}

    /* .title {
  margin-top: 100px;
} */

    .container {
      /* background-color: rgb(51, 48, 48); */
      color: white;
      margin-top: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .yellow {
      border: 1px solid rgb(41, 228, 135);
    }

    .oneAnime {
      /* border: 1px solid black; */
      /* background-color: rgb(51, 48, 48);   */
      text-align: left;
      width: 100%;
      height: 100%;
      margin: 5px;
      padding: 5px;
      object-fit: cover;
    }

    .saveBtn {
      float: right;
    }

    .borderBottom {
      border-bottom: 1px dotted rgb(41, 228, 135);
      padding-bottom: 20px;
      padding-top: 20px;
    }

    img {
      width: 200px;
      height: auto;
      border: 1px solid black;
      float: left;
      padding: 0px;
      margin-right: 10px;
      display: block;
    }

    h2 {
      padding: 0px;
      margin: 10px;
    }

    h3 {
      padding: 0px;
      margin: 0px;
    }

    h4 {
      padding: 0px;
      margin: 0px;
    }

    .searchBar {
      width: 300px;
      float: left;
      padding-right: 10px;
    }

    .fade-in {
      animation: fadeIn ease 5s;
      -webkit-animation: fadeIn ease 5s;
      -moz-animation: fadeIn ease 5s;
      -o-animation: fadeIn ease 5s;
      -ms-animation: fadeIn ease 5s;
    }

    @keyframes fadeIn {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    @-moz-keyframes fadeIn {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    @-webkit-keyframes fadeIn {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    @-o-keyframes fadeIn {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    @-ms-keyframes fadeIn {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }
  </style>
</head>

<body>


  <!-- Dropdown Structure -->

 

  <ul class="h-menu bg-black fg-white">
    <li><a href="./index.html">
        <span class="mif-home mif-lg fg-teal"></span>
        Home
      </a></li>
    <li class="divider"></li>
    <li><a href="./creators.html">
        <span class="mif-users mif-lg fg-pink"></span>
        Creators
      </a></li>
    <li>
      <a href="#" class="dropdown-toggle bg-black fg-white">
        <span class="mif-user mif-lg fg-amber"></span>
        Username<span class="mif-arrow-drop-down fg-amber"></span></a>
      <ul class="d-menu bg-black fg-white" data-role="dropdown">
        <li><a href="./profile.html">
            <span class="mif-profile mif-lg fg-violet"></span>
            Profile</a></li>
        <li><a href="./login.html">
            <span class="mif-user-check mif-lg fg-lime"></span>
            Sign In</a></li>
        <li><a href="./register.html">
            <span class="mif-user-plus mif-lg fg-yellow"></span>
            Create Account</a></li>
        <li><a href="./index.html">
            <span class="mif-cross mif-lg fg-red"></span>
            Sign Out
          </a></li>
      </ul>
    </li>
  </ul>

  <!-- <div class="navview-content"> -->
  <div data-role="carousel" data-height="300px" data-auto-start="true" data-cls-controls="fg-white"
    data-control-next="<span class='mif-chevron-right'></span>"
    data-control-prev="<span class='mif-chevron-left'></span>">

    <div class="slide" data-cover="https://pbs.twimg.com/media/EzXe_zSUYAIh45q.jpg"></div>
    <div class="slide" data-cover="https://i.pinimg.com/originals/e0/4f/b5/e04fb53e97ff1656bc0ddb9e50b139a6.jpg"></div>
    <div class="slide" data-cover="https://static.tumblr.com/gpbjshz/mm7nx60jz/3.png"></div>
  </div>

  <div class="container yellow">
    <h2 class="center-align title">Anime Search</h2>
    <div class="row">
      <div class="col l12 class center-align">
        <!-- <a href="/saved">Saved </a> -->
        <form>
          <p>
          <div class="searchBar">
            <input class="center-align" type="text" name="search" id="searchInfo" placeholder="Search for Anime...">
          </div>

          </p>
          <button class="button success outline" id="search">Search</button>
        </form>
      </div>
    </div>

    <div class="row" id="results"></div>
    <div class="row" id="more"></div>

  </div>

  <!-- </div>
</div> -->


  <!-- <header>hhhhhh</header> -->

 <!-- <div class="word">This is where you search for your anime</div> -->

  <!-- Metro4 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link href="metro-icons.css" rel="stylesheet">
  <script>

    // Materialize to use JS ex: Nav Bar and drop down menus 
    // M.AutoInit()

    // click event for searching anime
    document.getElementById(`search`).addEventListener(`click`, event => {
      event.preventDefault()
      const searchInfo = document.getElementById(`searchInfo`).value

      // removes previous search from innerHTML 
      document.getElementById('results').innerHTML = ''
      document.getElementById('more').innerHTML = ''

      // adds more results button after first search (currently only using 10 results)
      let moreResults = document.createElement('button');
      moreResults.classList = "center-align col s12 m6 l6 offset-m3 offset-l3";
      moreResults.innerHTML = "More Results";

      document.getElementById('more').append(moreResults)


      // get request for anime
      axios.get(`https://kitsu.io/api/edge/anime?filter[text]=${searchInfo}`)
        .then(res => {
          console.log(res.data.data)
          const search = res.data.data
          for (let searchIndex = 0; searchIndex < 5; searchIndex++) {
            let searchResults = search[searchIndex];
            let searchId = searchResults.id;
            let searchURL = searchResults.attributes.posterImage.medium;
            let searchTitle = searchResults.attributes.canonicalTitle;
            let searchSynopsis = searchResults.attributes.synopsis;
            let searchScore = searchResults.attributes.averageRating;
            let searchElem = document.createElement('div');
            searchElem.classList = " ";

            // what is going to be appended on the page from API information//
            // <button class="mif-add data-index="${searchId}"></button>


            searchElem.innerHTML =
              `
              <div class="oneAnime borderBottom">
              <div class="fade-in">
              <img src='${searchURL}' alt='${searchTitle}'">
              </div>
              <button class="button primary">
                <i class="mif-add fg-green mif-5x" data-index="${searchId}"></i>
              </button>
              <h3>${searchTitle}</h3>
              <h4>Rating: ${searchScore}</h4>
              <p><strong>Synopsis</strong>: ${searchSynopsis}</p>
              </div>
              `;

            // click even to save and push to database using ID/data-index
            document.addEventListener('click', event => {

              const index = parseInt(event.target.dataset.index)
              if (event.target.className === 'save btn-btn-primary' && index == searchId) {
                console.log(index)
                console.log(searchId)

                // console.log(searchResults)
                const anime = {
                  title: `${searchTitle}`,
                  image: `${searchURL}`,
                  rating: `${searchScore}`,
                  synopsis: `${searchSynopsis}`
                }
                console.log(anime)



                axios.post('/api/animes', anime, {
                  headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                  }
                })
                  .then(() => console.log(`anime saved`))
                  .catch(err => location = 'login.html')
              }



            });


            document.getElementById(`results`).append(searchElem)

          }


          // get request for second anime search (same as above)
          document.getElementById('more').addEventListener('click', event => {
            document.getElementById('results').innerHTML = ''
            document.getElementById('more').innerHTML = ''

            for (let searchIndex = 5; searchIndex < 10; searchIndex++) {
              let searchResults = search[searchIndex];
              let searchId = searchResults.id
              let searchURL = searchResults.attributes.posterImage.medium;
              let searchTitle = searchResults.attributes.canonicalTitle;
              let searchSynopsis = searchResults.attributes.synopsis;
              let searchScore = searchResults.attributes.averageRating;
              let searchElem2 = document.createElement('div');
              searchElem2.classList = "col";


              searchElem2.innerHTML =
                `
              <h2>${searchTitle}</h2><img src='${searchURL}' alt='${searchTitle}' style="width:75%;">
              <h4>Score: ${searchScore}</h4>
              <p>Synopsis: ${searchSynopsis}</p>
              <button class ="save btn-btn-primary" data-index="${searchId}">"Add to my List"</button>
              `;


              document.addEventListener('click', event => {
                console.log(`ping`)
                const index = parseInt(event.target.dataset.index)
                if (event.target.className === 'save btn-btn-primary' && index == searchId) {

                  console.log(searchResults)
                  const anime = {
                    title: `${searchTitle}`,
                    image: `${searchURL}`,
                    rating: `${searchScore}`,
                    synopsis: `${searchSynopsis}`
                  }
                  console.log(anime)
                  // console.log(anime)
                  axios.post('/api/animes', anime, {
                    headers: {
                      'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                  })

                    .then(() => console.log(`anime saved`))
                    .catch(err => location = 'login.html')

                }
              });

              document.getElementById(`results`).append(searchElem2)

            }
          })

        })
        .catch(err => console.log(err))
    })

    async function logoutUser() {
      localStorage.removeItem('username')
      localStorage.removeItem('token')
      location = '/login.html'
    }

    document.getElementById('logout').addEventListener('click', logoutUser)

  </script>

  <script src="https://cdn.metroui.org.ua/v4.3.2/js/metro.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</body>

</html>